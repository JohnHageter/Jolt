package Jolt;

<<<<<<< HEAD
import ij.IJ;
import ij.ImageJ;
import ij.ImagePlus;
import ij.ImageStack;
import ij.Macro;
import ij.Prefs;
import ij.Undo;
import ij.WindowManager;
import ij.gui.ColorChooser;
import ij.gui.GUI;
import ij.gui.GenericDialog;
import ij.gui.ImageCanvas;
import ij.gui.ImageRoi;
import ij.gui.MessageDialog;
import ij.gui.Overlay;
import ij.gui.Plot;
import ij.gui.PointRoi;
import ij.gui.PolygonRoi;
import ij.gui.ProfilePlot;
import ij.gui.Roi;
import ij.gui.RoiProperties;
import ij.gui.ShapeRoi;
import ij.gui.TextRoi;
import ij.gui.Toolbar;
import ij.gui.YesNoCancelDialog;
import ij.io.OpenDialog;
import ij.io.Opener;
import ij.io.RoiDecoder;
import ij.io.RoiEncoder;
import ij.io.SaveDialog;
import ij.macro.Interpreter;
import ij.macro.MacroRunner;
import ij.measure.Calibration;
import ij.measure.ResultsTable;
import ij.plugin.Colors;
import ij.plugin.MacroInstaller;
import ij.plugin.OverlayCommands;
import ij.plugin.OverlayLabels;
import ij.plugin.RoiRotator;
import ij.plugin.RoiScaler;
import ij.plugin.filter.Analyzer;
import ij.plugin.filter.Filler;
import ij.plugin.frame.PlugInFrame;
import ij.process.FloatPolygon;
import ij.process.ImageProcessor;
import ij.process.ImageStatistics;
import ij.util.Tools;
import java.awt.BorderLayout;
import java.awt.Button;
import java.awt.Checkbox;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.EventQueue;
import java.awt.Font;
import java.awt.Frame;
import java.awt.GridLayout;
import java.awt.List;
import java.awt.MenuItem;
import java.awt.Panel;
import java.awt.Point;
import java.awt.PopupMenu;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseWheelEvent;
import java.awt.event.MouseWheelListener;
import java.awt.event.WindowEvent;
import java.io.BufferedOutputStream;
import java.io.ByteArrayOutputStream;
import java.io.DataOutputStream;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.zip.ZipEntry;
import java.util.zip.ZipException;
import java.util.zip.ZipInputStream;
import java.util.zip.ZipOutputStream;
import javax.swing.*;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

public class CellManager extends PlugInFrame implements ActionListener, ItemListener, MouseListener, MouseWheelListener, ListSelectionListener, Iterable<Roi> {
    public static final String LOC_KEY = "manager.loc";
    private static final String MULTI_CROP_DIR = "multi-crop.dir";
    private static final int BUTTONS = 11;
    private static final int DRAW = 0;
    private static final int FILL = 1;
    private static final int LABEL = 2;
    private static final int SHOW_ALL = 0;
    private static final int SHOW_NONE = 1;
    private static final int LABELS = 2;
    private static final int NO_LABELS = 3;
    private static final int MENU = 0;
    private static final int COMMAND = 1;
    private static final int IGNORE_POSITION = -999;
    private static final int CHANNEL = 0;
    private static final int SLICE = 1;
    private static final int FRAME = 2;
    private static final int SHOW_DIALOG = 3;
    private static int rows = 15;
    private static int lastNonShiftClick = -1;
    private static boolean allowMultipleSelections = true;
    private static String moreButtonLabel = "More Â»";
    private Panel panel;
    private static Frame instance;
    private static int colorIndex = 4;
    private JList list;
    private DefaultListModel listModel;
    private ArrayList rois = new ArrayList();
    private boolean canceled;
    private boolean macro;
    private boolean ignoreInterrupts;
    private PopupMenu pm;
    private Button moreButton;
    private Button colorButton;
    private Checkbox showAllCheckbox = new Checkbox("Show All", false);
    private Checkbox labelsCheckbox = new Checkbox("Labels", false);
    private Overlay overlayTemplate;
    private static boolean measureAll = true;
    private static boolean onePerSlice = true;
    private static boolean restoreCentered;
    private int prevID;
    private boolean noUpdateMode;
    private int defaultLineWidth = 1;
    private Color defaultColor;
    private boolean firstTime = true;
    private boolean appendResults;
    private static ResultsTable mmResults;
    private static ResultsTable mmResults2;
    private int imageID;
    private boolean allowRecording;
    private boolean recordShowAll = true;
    private boolean allowDuplicates;
    private double translateX = 10.0;
    private double translateY = 10.0;
    private static String errorMessage;
    private boolean multiCropShow = true;
    private boolean multiCropSave;
    private int multiCropFormatIndex;
    private static double angle = 45.0;
    private static double xscale = 1.5;
    private static double yscale = 1.5;
    private static boolean scaleCentered = true;
    private static boolean channel = false;
    private static boolean slice = true;
    private static boolean frame = false;


    public CellManager() {
        super("Cell Manager");
        if(instance != null){
            WindowManager.toFront(instance);
        } else {
            instance = this;
            this.list = new JList();
            errorMessage = null;
            this.showWindow();
        }
        showWindow();
    }

    void showWindow() {
        ImageJ ij = IJ.getInstance();

        this.addKeyListener(ij);
        this.addMouseListener(this);
        this.addMouseWheelListener(this);

        WindowManager.addWindow(this);
        this.setLayout(new BorderLayout());

        this.listModel = new DefaultListModel();
        this.list.setModel(this.listModel);
        GUI.scale(list);
        list.setPrototypeCellValue("Cell-0000-0000");

        list.addListSelectionListener(this);
        list.addKeyListener(ij);
        list.addMouseListener(this);
        list.addMouseWheelListener(this);

        JScrollPane scrollPane = new JScrollPane(list, ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS, ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        add("Center", scrollPane);
        panel = new Panel();
        int nButtons = 8;
        panel.setLayout(new GridLayout(nButtons, 1, 5, 0));

        addButton("Add [t]");
        addButton("Delete");
        addButton("Rename");
        addButton("Measure Grey");
        addButton("Measure DeltaF");
        addButton("Deselect");
        addButton("Properties...");
        addButton(moreButtonLabel);

        showAllCheckbox.addItemListener(this);
        panel.add(labelsCheckbox);
        labelsCheckbox.addItemListener(this);

        panel.add(labelsCheckbox);
        add("East", panel);
        addPopupMenu();
        GUI.scale(this);
        pack();
        Dimension size = getSize();
        if (size.width>270)
            setSize(size.width-40, size.height);
        list.remove(0);
        Point loc = Prefs.getLocation(LOC_KEY);
        if (loc!=null)
            setLocation(loc);
        else
            GUI.centerOnImageJScreen(this);

        setVisible(true);
    }

=======
import ij.gui.GenericDialog;
import ij.plugin.frame.PlugInFrame;

import javax.swing.*;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import java.awt.*;
import java.awt.event.*;
import java.util.Iterator;

import ij.*;
import ij.process.*;
import ij.gui.*;
import ij.io.*;
import ij.plugin.filter.*;
import ij.plugin.*;
import ij.util.*;
import ij.macro.*;
import ij.measure.*;
import ij.plugin.OverlayCommands;

public class CellManager extends PlugInFrame implements ActionListener, ItemListener, MouseListener, MouseWheelListener, ListSelectionListener, Iterable<Roi> {
    private static final int BUTTONS = 7;

    private static Frame instance;
    private Panel panel;
    private JPanel buttonPanel;
    private PopupMenu popupMenu;
    private JTabbedPane cellTabs;
    private Button moreButton;
    private JPanel cellGroups;
    private JPanel cellsInd;

    private JList cellList;
    private DefaultListModel cellListModel;


    public String errorMsg;

    public CellManager() {
        super("Cell Manager");
        if(instance != null) {
            WindowManager.toFront(instance);
            return;
        }

        instance = this;
        cellList = new JList();
        errorMsg = null;
        showWindow();

    }

    private void showWindow() {
        ImageJ ij = IJ.getInstance();
        addKeyListener(ij);
        addMouseListener(this);
        addMouseWheelListener(this);
        WindowManager.addWindow(this);

        setLayout(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();

        { // Initialize list of cell entities
            cellListModel = new DefaultListModel<>();
            cellList.setModel(cellListModel);
            GUI.scale(cellList);
            cellList.setPrototypeCellValue("0000-0000-0000");
            cellList.addListSelectionListener(this);
            cellList.addKeyListener(ij);
            cellList.addMouseWheelListener(this);
            cellList.addMouseListener(this);
        }

        panel = new Panel();
        panel.setLayout(new BorderLayout());

        { // add group tabs to panel
            cellTabs = new JTabbedPane();
            cellGroups = new JPanel();
            cellGroups.setLayout(new BorderLayout());
            cellGroups.add(new JScrollPane(), BorderLayout.WEST);

            cellsInd = new JPanel();
            cellsInd.setLayout(new BorderLayout());
            cellsInd.add(new JScrollPane(), BorderLayout.WEST);

            cellTabs.add("Groups", cellGroups);
            cellTabs.add("Cells", cellsInd);

            cellTabs.addMouseListener(new MouseAdapter() {
                @Override
                public void mouseClicked(MouseEvent e) {
                    if (e.getClickCount() == 2) {
                        int tabIndex = cellTabs.getSelectedIndex();
                        if (tabIndex != -1) {
                            String newTabName = JOptionPane.showInputDialog(panel, "Enter new name for tab:", cellTabs.getTitleAt(tabIndex));
                            if (newTabName != null && !newTabName.trim().isEmpty()) {
                                cellTabs.setTitleAt(tabIndex, newTabName.trim());
                            }
                        }
                    }
                }
            });

            panel.add(cellTabs, BorderLayout.CENTER);
        }

        { // add buttons to panel
            buttonPanel = new JPanel();
            buttonPanel.setLayout(new BoxLayout(buttonPanel, BoxLayout.Y_AXIS));
            addButton("Add cell [t]");
            addButton("Remove cell [x]");
            addButton("Add group");
            addButton("Remove group");
            addButton("Open...");
            addButton("Save...");
            addButton("Rename");
            addButton("More...");
            addMoreMenu();
            GUI.scale(this);
        }

        { // add panels to frame
            gbc.gridx = 0;
            gbc.gridy = 0;
            gbc.weightx = 0.90;
            gbc.weighty = 1.0;
            gbc.fill = GridBagConstraints.BOTH;
            add(panel, gbc);

            gbc.gridx = 1;
            gbc.gridy = 0;
            gbc.weightx = 0.10;
            gbc.weighty = 1.0;
            gbc.fill = GridBagConstraints.BOTH;
            add(buttonPanel, gbc);
        }

        setSize(400, 400);
        setVisible(true);
    }

    void addMoreMenu(){
        popupMenu = new PopupMenu();
        GUI.scalePopupMenu(popupMenu);
        addMoreMenuItem("Multi-select annotate");
        addMoreMenuItem("Group-select annotate");
        addMoreMenuItem("Measure multiple");
        add(popupMenu);
    }

    void addMoreMenuItem(String s){
        MenuItem mItem = new MenuItem(s);
        mItem.addActionListener(this);
        popupMenu.add(mItem);
    }

>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    void addButton(String label) {
        Button b = new Button(label);
        b.addActionListener(this);
        b.addKeyListener(IJ.getInstance());
<<<<<<< HEAD
        b.addMouseListener(this);
        if (label.equals(moreButtonLabel)) moreButton = b;
        panel.add(b);
    }

    void addPopupMenu() {
        pm = new PopupMenu();
        GUI.scalePopupMenu(pm);
        addPopupItem("Open...");
        addPopupItem("Save...");
        add(pm);
    }

    void addPopupItem(String s) {
        MenuItem mi=new MenuItem(s);
        mi.addActionListener(this);
        pm.add(mi);
    }

    @Override
    public void itemStateChanged(ItemEvent e) {

    }

    @Override
=======
        if (label.equals("More...")) moreButton = b;
        b.addMouseListener(this);
        buttonPanel.add(b);
    }

    private void addNewGroupTab() {
        int groupCount = cellTabs.getTabCount() - 1;
        JPanel newGroupPanel = new JPanel(new BorderLayout());
        newGroupPanel.add(new JScrollPane(), BorderLayout.WEST);
        cellTabs.add("Group " + (groupCount + 1), newGroupPanel);
    }

    private void removeGroupTab() {
        int groupIndex = cellTabs.getSelectedIndex();
        cellTabs.remove(groupIndex);
    }

    public void actionPerformed(ActionEvent e) {
        String command = e.getActionCommand();
        switch (command) {
            case "Add group":
                addNewGroupTab();
                break;
            case "Remove group":
                removeGroupTab();
                break;
            case "More...":
                Point ploc = buttonPanel.getLocation();
                Point bloc = moreButton.getLocation();
                popupMenu.show(this, ploc.x, bloc.y);
                break;
            default:
                break;
        }
    }


>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    public void mouseClicked(MouseEvent e) {

    }

<<<<<<< HEAD
    @Override
=======
>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    public void mousePressed(MouseEvent e) {

    }

<<<<<<< HEAD
    @Override
=======
>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    public void mouseReleased(MouseEvent e) {

    }

<<<<<<< HEAD
    @Override
=======
>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    public void mouseEntered(MouseEvent e) {

    }

<<<<<<< HEAD
    @Override
=======
>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    public void mouseExited(MouseEvent e) {

    }

<<<<<<< HEAD
    @Override
=======
>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
    public void mouseWheelMoved(MouseWheelEvent e) {

    }

<<<<<<< HEAD
    @Override
    public void valueChanged(ListSelectionEvent e) {

    }

    @Override
    public void actionPerformed(ActionEvent e) {

    }
=======

    public void itemStateChanged(ItemEvent e) {

    }

>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009

    public Iterator<Roi> iterator() {
        return null;
    }
<<<<<<< HEAD
=======


    public void valueChanged(ListSelectionEvent e) {

    }
>>>>>>> 7074810e5b594ac7286e3b714e4ccdf2b2339009
}
